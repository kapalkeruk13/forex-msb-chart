<!DOCTYPE html>
<html>
<head>
    <title>Forex MSB Chart</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>

<body style="margin:0;background:#0e0e0e;">

<div id="chart" style="height:100vh;"></div>

<script>

// =========================
// CREATE CHART
// =========================
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout: {
        background: { color: '#0e0e0e' },
        textColor: '#DDD',
    },
    grid: {
        vertLines: { color: '#1f1f1f' },
        horzLines: { color: '#1f1f1f' },
    },
});

const candleSeries = chart.addCandlestickSeries();

// =========================
// DUMMY DATA (TEST)
// =========================
let data = [];

for (let i = 0; i < 200; i++) {
    let base = 100 + i * 0.2;

    data.push({
        time: 1700000000 + i * 60,
        open: base + Math.random(),
        high: base + 2 + Math.random(),
        low: base - 2 - Math.random(),
        close: base + (Math.random() - 0.5) * 3,
    });
}

candleSeries.setData(data);

// =========================
// MSB DETECTION
// =========================
function detectMSB(data) {

    const markers = [];

    for (let i = 2; i < data.length - 2; i++) {

        // Swing High
        if (
            data[i].high > data[i-1].high &&
            data[i].high > data[i+1].high
        ) {
            if (data[i+1].close > data[i].high) {
                markers.push({
                    time: data[i+1].time,
                    position: 'aboveBar',
                    color: 'green',
                    shape: 'arrowUp',
                    text: 'BOS UP'
                });
            }
        }

        // Swing Low
        if (
            data[i].low < data[i-1].low &&
            data[i].low < data[i+1].low
        ) {
            if (data[i+1].close < data[i].low) {
                markers.push({
                    time: data[i+1].time,
                    position: 'belowBar',
                    color: 'red',
                    shape: 'arrowDown',
                    text: 'BOS DOWN'
                });
            }
        }
    }

    candleSeries.setMarkers(markers);
}

detectMSB(data);

</script>

</body>
</html>
